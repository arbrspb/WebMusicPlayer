# WebMusicPlayer

**WebMusicPlayer** — это интеллектуальный музыкальный проигрыватель с веб-интерфейсом, поддержкой автоматической сортировки треков по жанрам, интеграцией с Rekordbox, возможностью обучения собственной модели жанровой классификации на основе аудиопризнаков, а также расширенной системой метаданных (цвет, рейтинг, BPM, ситуация и др.).

---

## Основные возможности

- **Веб-интерфейс** для управления музыкальной коллекцией, выбора и воспроизведения треков.
- **Автоматическая классификация треков по жанрам** с помощью обучаемой ML-модели.
- **Гибкая система настроек признаков** (MFCC, Chroma, Spectral Contrast, Zero Crossing Rate, Tonnetz).
- **Интеграция с Rekordbox** — импорт дополнительных метаданных (color, rating, bpm, situation).
- **Определение жанра по ID3, по структуре папок (samples/ЖАНР), или аудиоанализу**.
- **Возможность переобучения модели** на своей коллекции.
- **Поддержка работы с большими музыкальными библиотеками**.
- **Мультиязычный интерфейс (RU/EN)**.

---

## Характеристики проекта

- **Язык:** Python 3.9+
- **Веб-фреймворк:** Flask
- **ML-библиотека:** scikit-learn (RandomForestClassifier), librosa (аудиофичи)
- **Парсинг тегов:** mutagen (EasyID3)
- **Хранение настроек:** JSON
- **Работа с аудио:** mp3 (и другие форматы, поддерживаемые librosa)
- **Поддержка Docker:** (опционально)

---

## Быстрый старт

### 1. Клонирование репозитория

```bash
git clone https://github.com/arbrspb/WebMusicPlayer.git
cd WebMusicPlayer
```

### 2. Установка зависимостей

Рекомендуется использовать виртуальное окружение:

```bash
python -m venv venv
source venv/bin/activate  # или .\venv\Scripts\activate для Windows
pip install -r requirements.txt
```

### 3. Основная структура папок

- `app/` — основной backend-код (Flask, ML, обработка музыки)
- `templates/` — HTML-шаблоны для веб-интерфейса
- `static/` — статические файлы (js, css, изображения)
- `samples/` — папки для обучения и классификации по жанрам (см. ниже)
- `reckordbox_parcer_file_output/` — импортированные треки и метаданные Rekordbox

### 4. Запуск приложения

```bash
python run.py
```
Веб-интерфейс будет доступен по адресу http://localhost:5000

---

## Инструкция по обучению и настройке модели

### 1. Подготовьте обучающие данные

- Для базового обучения создайте структуру папок `samples/ЖАНР` (например, `samples/House`, `samples/Pop` и т.д.) и скопируйте туда треки соответствующего жанра (рекомендуется не менее 20 на папку).
- Для расширенного обучения импортируйте треки из Rekordbox через JSON (поддерживаются extra-метаданные).

### 2. Настройте параметры анализа

В веб-интерфейсе (раздел "Настройки" или "librosa") вы можете выбрать:
- Какие аудиофичи использовать (MFCC, Chroma, Spectral Contrast и др.)
- Использовать ли жанр по ID3-тегу
- Использовать ли Rekordbox-метаданные (color, рейтинг, bpm, ситуация)
- Порог уверенности для жанровой классификации
- Другие параметры аудиопрепроцессинга (sample_rate, duration и пр.)

### 3. Обучение модели

- В интерфейсе нажмите "Переобучить модель" — будет произведён анализ всех треков в `samples/ЖАНР` и (опционально) из Reckordbox.
- После обучения появится файл `genre_model.pkl` — основная модель жанровой классификации.

### 4. Сканирование библиотеки

- После переобучения рекомендуется пересканировать музыкальную библиотеку для применения новых жанров и метаданных.

---

## Как работает определение жанра

1. **Жанр по ID3**: если включено и тег присутствует — берётся он.
2. **Жанр по папке**: если включено, определяется по имени папки (например, `samples/Pop` → `Pop`).
3. **Аудиоанализ**: если предыдущие способы не сработали, используется ML-модель на аудиофичах и (опционально) метаданных.

---

## Описание признаков

- **Аудиофичи (librosa features)**:  
  - MFCC (мел-частотные кепстральные коэффициенты)
  - Chroma
  - Spectral Contrast
  - Zero Crossing Rate (ZCR)
  - Tonnetz

- **Метаданные (Rekordbox, ID3)**:
  - `genre` — жанр (по тегу или папке)
  - `color` — цвет трека (Rekordbox)
  - `rating` — рейтинг (0–5)
  - `bpm` — темп
  - `situation` — ситуация/настроение

---

## Часто задаваемые вопросы (FAQ)

**Q:** Можно ли отключить определённые признаки?  
**A:**  
- Аудиофичи можно гибко включать/выключать в настройках.
- Признаки из Rekordbox (color, рейтинг и т.д.) — включаются только если активирована опция.
- Жанр по папкам samples/ЖАНР — всегда используется, если такие папки есть.
- Жанр по ID3 — можно отключить через настройки.

**Q:** Какие форматы аудио поддерживаются?  
**A:** Любые, которые поддерживаются библиотекой librosa (mp3, wav, flac и др.)

**Q:** Можно ли обучить модель на своих жанрах?  
**A:** Да! Просто создайте нужные папки в samples/ и поместите туда треки.

**Q:** Как проверить, какие признаки реально использует модель?  
**A:** Список формируется при обучении: сначала аудиофичи, затем (если есть) rating, bpm, color, situation.

---

## Советы по улучшению качества классификации

- Используйте разнообразные и качественные треки для обучения.
- Не добавляйте короткие или "обрезанные" треки.
- Увеличивайте количество треков в жанре для повышения точности.
- Подбирайте параметры аудиофичей (например, увеличьте количество MFCC).

---

## TODO / Roadmap

- Docker-образ для быстрого запуска
- Интеграция с другими DJ/DAW-системами
- Продвинутая визуализация статистики библиотеки
- Поддержка пользовательских тегов

---

## Лицензия

MIT

---

**Автор:** [arbrspb](https://github.com/arbrspb)  
**Контакты:** см. issues на GitHub
